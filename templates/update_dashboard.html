<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="/static/style.css">

<div class="container">
<h2>Linux Update Dashboard</h2>

<p>
  <a class="btn" href="/index">‚Üê Back to Main Menu</a>
  <a class="btn" href="/hosts">Manage Hosts</a>
  <a class="btn" href="/update_settings" style="background: #059669;">Update Settings</a>
</p>

{% with messages = get_flashed_messages() %}
  {% if messages %}
    {% for message in messages %}
      <div class="alert">{{ message }}</div>
    {% endfor %}
  {% endif %}
{% endwith %}

{% if update_notification %}
<div class="card" style="background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); border: 2px solid #60a5fa;">
  <h3 style="color: #dbeafe; margin-bottom: 0.5rem;">üîî Dashboard Update Available!</h3>
  <p style="color: #bfdbfe; margin-bottom: 1rem;">
    <strong>{{ update_notification.description }}</strong><br>
    Version: {{ update_notification.version }} ({{ update_notification.type }})
  </p>
  <div style="display: flex; gap: 0.5rem; flex-wrap: wrap;">
    {% if is_admin %}
    <a class="btn" href="/dashboard_version/update" style="background: #059669;">
      Update Now
    </a>
    {% endif %}
    <a class="btn" href="/dashboard_version/check" style="background: #7c3aed;">
      Check Again
    </a>
    {% if update_notification.url %}
    <a class="btn" href="{{ update_notification.url }}" target="_blank" style="background: #475569;">
      View on GitHub
    </a>
    {% endif %}
    <a class="btn" href="/dashboard_version/dismiss" style="background: #64748b;">
      Dismiss
    </a>
  </div>
</div>
{% endif %}

<!-- Automatic Update Status Card -->
<div class="card" style="background: {% if auto_updates_enabled %}#065f46{% else %}#1e293b{% endif %}; border: 1px solid {% if auto_updates_enabled %}#10b981{% else %}#334155{% endif %};">
  <h3>Automatic Updates: {% if auto_updates_enabled %}‚úì Enabled{% else %}‚úó Disabled{% endif %}</h3>
  <p>
    {% if auto_updates_enabled %}
      Automatic updates are running <strong>{{ update_frequency }}</strong>.
      {% if last_auto_update %}
        <br>Last automatic update: {{ last_auto_update }}
      {% endif %}
    {% else %}
      Automatic updates are currently disabled. Visit <a href="/update_settings" style="color: #60a5fa;">Update Settings</a> to enable.
    {% endif %}
  </p>
</div>

{% for name in hosts %}
<div class="card">
  <b>{{ name }}</b><br>
  Status:
  <span class="{{ 'status-online' if status[name] else 'status-offline' }}">
    {{ 'Online' if status[name] else 'Offline' }}
  </span><br>
  {% if name in os_info %}
    OS: <span style="color: #60a5fa; font-weight: 500;">{{ os_info[name].os_name|title }}{% if os_info[name].os_version and os_info[name].os_version != 'unknown' %} {{ os_info[name].os_version }}{% endif %}</span>
    {% if os_info[name].os_name == 'windows' %}
      <span style="background: #1e40af; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.75rem; margin-left: 4px;">ü™ü</span>
    {% elif os_info[name].os_name in ['ubuntu', 'debian', 'fedora', 'centos', 'arch'] %}
      <span style="background: #047857; color: white; padding: 2px 6px; border-radius: 3px; font-size: 0.75rem; margin-left: 4px;">üêß</span>
    {% endif %}
    <br>
  {% endif %}
  <br>
  <a class="btn" href="/update/{{ name }}">Full Update</a>
  <a class="btn" href="/update_repo/{{ name }}" style="background: #7c3aed;" title="Update packages from repository while keeping host configuration files unchanged">Repo Update</a>
  <a class="btn" href="/hosts/edit/{{ name }}" style="background: #475569;">Edit</a>
</div>
{% endfor %}

<h3>Update History</h3>
{% for h in history %}
<div class="card">
  {{ h.time }} ‚Äî {{ h.host }} ‚Äî {{ h.status }}
  {% if h.type %}
    <span style="color: #94a3b8;"> ({{ h.type }})</span>
  {% endif %}
</div>
{% endfor %}
</div>
